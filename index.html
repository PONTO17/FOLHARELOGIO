<!-- index.html — agora integrando com Google Sheets -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro, Lista e Impressão</title>
  <style>/* (mesmo CSS de antes – mantido) */</style>
</head>
<body>

<h2>Cadastro e Impressão</h2>

<script>
/* ===== CONFIGURAÇÕES ===== */
const STORAGE_KEY = 'cadastros_ponto17';
const SCRIPT_URL  = 'https://script.google.com/macros/s/COLE_AQUI_O_URL_DO_SEU_WEBAPP/exec'; // ❶ troque depois

/* ======== PERSISTÊNCIA LOCAL ======== (igual) */
window.addEventListener('load', () => {
  carregarDoLocal();          // offline
  carregarDaPlanilha();       // online (Google Sheets)
});

/* ---------- salvar local --------- */
function salvarNoLocal(){
  const cadastros = lerTabelaCadastros();
  localStorage.setItem(STORAGE_KEY, JSON.stringify(cadastros));
}

/* ---------- carregar local -------- */
function carregarDoLocal(){
  const dados = localStorage.getItem(STORAGE_KEY);
  if(dados){
    try { preencherTabela(JSON.parse(dados)); }
    catch(e){ console.error(e); }
  }
}

/* ---------- carregar da planilha -------- */
async function carregarDaPlanilha(){
  try{
    const res   = await fetch(`${SCRIPT_URL}?action=list`);
    if(!res.ok) throw new Error(res.statusText);
    const json  = await res.json();
    preencherTabela(json);
  }catch(err){
    console.warn('Não foi possível baixar dados da planilha:', err.message);
  }
}

/* ---------- enviar 1 registro -------- */
async function enviarParaPlanilha(reg){
  try{
    await fetch(SCRIPT_URL, {
      method : 'POST',
      headers: {'Content-Type':'application/json'},
      body   : JSON.stringify(reg)
    });
    console.log('Registro enviado à planilha');
  }catch(e){
    console.error('Falha ao enviar à planilha:', e.message);
  }
}

/* ======== RESTANTE DO CÓDIGO ========  */
/* (todo o JavaScript que já existia – 
   confirmarCadastro, imprimirRegistro, 
   utilidades, etc. – permanece igual,
   exceto pelas duas linhas marcadas abaixo) */

function confirmarCadastro(){
  /* ... código idêntico até registroCount++ ... */

  /* NOVO: objeto com os dados principais ↓  */
  const registroObj = {
    numero  : row.cells[0].textContent,
    nome    : row.cells[1].textContent,
    telefone: row.cells[2].textContent,
    objetos : row.cells[3].textContent,
    entrada : row.cells[4].textContent,
    volta   : row.cells[5].textContent,
    valor   : row.cells[6].textContent,
    pagou   : paySelect.value,
    status  : stSelect.value,
    obs     : obs
  };
  enviarParaPlanilha(registroObj);   // ❷ envia online
  salvarNoLocal();
}

/* ======== (restante igual) ======== */
</script>

<!-- (resto do HTML idêntico ao anterior) -->
</body>
</html>
