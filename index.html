<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Cadastro, Lista e Impressão (Google Sheets Automático)</title>

  <!-- ===== CSS COMPLETO ===== -->
  <style>
    *{box-sizing:border-box;font-family:Arial, sans-serif}
    body{margin:20px;background:#f9f9f9}
    h2,h3,h4{margin:5px 0}

    .container-form{width:100%;background:#fff;border:1px solid #ccc;
                    padding:15px;margin-bottom:20px}
    .container-form h3{margin-bottom:15px}
    .container-form label{display:block;margin-bottom:5px;font-weight:bold}
    .container-form input,.container-form textarea{width:100%;padding:8px;margin-bottom:10px}

    #search-container{display:none;background:#fff;border:1px solid #ccc;
                      padding:15px;margin-bottom:20px}

    .botao-nova-aba{position:fixed;right:10px;top:50px;padding:10px 15px;
                    font-weight:bold;cursor:pointer;background:#007BFF;color:#fff;
                    border:none;border-radius:4px;display:none}

    table{width:100%;border-collapse:collapse;margin-bottom:20px}
    table,th,td{border:1px solid #ccc}
    th,td{padding:8px;text-align:center}

    .linha-concluida{background:#ccffcc!important}

    .pay-bullet{display:inline-block;width:12px;height:12px;border-radius:50%;
                margin-left:5px;vertical-align:middle}

    .editing-input{width:95%;background:#fffbe2;border:1px solid #ccc}

    .radio-group{margin-bottom:10px}
    .radio-group span{font-weight:bold;margin-right:10px}
    .radio-group input[type="radio"]{display:none}
    .radio-group .radio-btn{display:inline-block;padding:8px 16px;margin-right:5px;
                            border:1px solid #ccc;border-radius:4px;background:#f0f0f0;
                            cursor:pointer;transition:background .3s,color .3s}
    .radio-group input[type="radio"]:checked + .radio-btn{
      background:#007BFF;color:#fff;border-color:#007BFF}

    .impressao{display:none;position:absolute;left:-99999px;top:-99999px}

    @media print{
      body *{visibility:hidden!important}
      .impressao,.impressao *{visibility:visible!important}
      .impressao{display:block!important;position:fixed!important;top:0!important;
                 left:0!important;width:100%!important;background:#fff!important}
    }
  </style>
</head>

<body>
<h2>Cadastro e Impressão (Google Sheets Automático)</h2>

<!-- URL do Apps Script -->
<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxGJjSqGxx10bDDRS5l1PloX-xuPmotTxQ704cc1j9v_VwKC5Y0i_E0-5Nmta_-LFzMnQ/exec";
</script>

<!-- =========================== FORMULÁRIO =========================== -->
<div class="container-form">
  <h3>Cadastro</h3>
  <label for="cad-nome">Nome:</label>
  <input type="text" id="cad-nome" placeholder="Ex: Marcos Antônio">

  <label for="cad-telefone">Telefone:</label>
  <input type="text" id="cad-telefone" placeholder="Ex: (xx) 99999-9999">

  <label for="cad-servico">Objetos:</label>
  <input type="text" id="cad-servico" placeholder="Ex: Relógio (marca) dourado">

  <label for="cad-obs">DESCRIÇÃO DO SERVIÇO:</label>
  <textarea id="cad-obs" rows="3" placeholder="Ex: Troca de bateria e limpeza interna"></textarea>

  <label for="cad-dias-uteis">Quantos dias úteis?</label>
  <input type="number" id="cad-dias-uteis" placeholder="Ex: 5">

  <div class="radio-group">
    <span>É orçamento?</span>
    <input type="radio" id="orcamentoSim" name="cad-orcamento" value="sim">
    <label for="orcamentoSim" class="radio-btn" onclick="toggleValorField()">SIM</label>
    <input type="radio" id="orcamentoNao" name="cad-orcamento" value="nao" checked>
    <label for="orcamentoNao" class="radio-btn" onclick="toggleValorField()">NÃO</label>
  </div>

  <div id="cad-valor-field">
    <label for="cad-valor">Valor (R$):</label>
    <input type="text" id="cad-valor" placeholder="Ex: 150,00">
  </div>

  <button onclick="confirmarCadastro()">Confirmar & Imprimir</button>
  <button id="btnLimpar" onclick="limparCadastro()">Limpar</button>
</div>

<button onclick="toggleSearch()">BUSCAR SERVIÇO</button>
<div id="search-container">
  <h3>Buscar</h3>
  <input type="text" id="searchTerm" placeholder="Digite nome, telefone ou objeto">
  <button onclick="searchServices()">Buscar</button>
</div>

<h3>Lista de Cadastros</h3>
<table id="lista-cadastros">
  <thead>
    <tr>
      <th>Nº</th><th>Nome</th><th>Telefone</th><th>Objetos</th><th>Entrada</th>
      <th>Volta</th><th>Valor (R$)</th><th>Pagou?</th><th>Status</th><th>Ações</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button class="botao-nova-aba" id="btnNovaAba" onclick="abrirFolhaEmNovaAba()">
  Abrir Folha de Impressão
</button>

<!-- ====== FOLHA DE IMPRESSÃO (oculta) ====== -->
<div class="impressao" id="folha-impressao">
  <div class="recibo-header">
    <div><h3>PONTO 17</h3><p>Telefones: 3349-3318 / 3229-8972</p></div>
    <div class="numero"><h3>Nº <span id="print-id">__</span></h3></div>
  </div>

  <h3>Serviços Rápidos</h3>
  <div class="recibo-info">
    <div><label>Nome: </label><span id="print-nome"></span></div>
    <div><label>Telefone: </label><span id="print-telefone"></span></div>
    <div><label>Objetos: </label><span id="print-servico"></span></div>
    <div><label>DESCRIÇÃO DO SERVIÇO: </label><span id="print-obs"></span></div>
  </div>

  <hr>
  <h4>OBJETO/ORÇAMENTO</h4>
  <div class="recibo-info">
    <div><label>Valor (R$): </label><span id="print-valor">___</span></div>
    <div><label>Data Entrada: </label><span id="print-data-entrada">__/__/__</span></div>
    <div><label>Data Retirada: </label><span id="print-data-retirada">__/__/__</span></div>
    <div><label>Garantia até: </label><span id="print-garantia">__</span></div>
    <div style="margin-top:10px">
      <label>Termo:</label>
      <p id="print-termo">
        OBS: ESTOU CIENTE E DE ACORDO COM A ORIENTAÇÃO DO PROCON QUE OS APARELHOS
        NÃO RETIRADOS NO PRAZO MÁXIMO DE 30 DIAS SERÃO COBRADOS UMA TAXA DE
        ARMAZENAMENTO DE R$ 1,00 (UM REAL), E NO MÁXIMO 90 DIAS SERÃO VENDIDOS
        PARA COBRIR CUSTOS OPERACIONAIS, MESMO OS SERVIÇOS, JÁ SENDO PAGOS E/OU
        SINAL DE 50%.
      </p>
    </div>
  </div>

  <div class="assinaturas">
    <div>___________________________<br>Assinatura Cliente</div>
    <div>___________________________<br>Assinatura Funcionário Responsável</div>
  </div>
</div>

<!-- ====================== JAVASCRIPT COMPLETO ====================== -->
<script>
window.addEventListener('load', carregarDoGoogle);

let registroCount = 1;

/* ----------------------- FUNÇÕES AUXILIARES ----------------------- */
function toggleValorField(){ /* …mesma lógica de antes… */ }
function formatarValor(v){ const n=parseFloat(v.replace(',','.')); return isNaN(n)?"___":n.toFixed(2).replace('.',',') }
function parseDate(d){const p=d.split('/');return p.length===3?new Date(+p[2],+p[1]-1,+p[0]):new Date(0)}
function updateRowStyleStatus(row,s){ s==="CONCLUIDO"?row.classList.add('linha-concluida')
                                        :row.classList.remove('linha-concluida')}

/* ----------- TODAS as funções confirmarCadastro, createEditableCell,
               limparCadastro, lerTabelaCadastros, preencherTabela,
               searchServices, sortTableByStatusAndDate,
               abrirFolhaEmNovaAba — são as mesmas do seu arquivo
               original e estão omitidas aqui para encurtar ----------- */

/* ---------------------- COMUNICAÇÃO COM SHEETS --------------------- */
async function carregarDoGoogle(){
  try{
    const resp = await fetch(SCRIPT_URL);
    preencherTabela(await resp.json());
    console.log('Carregado do Google!');
  }catch(e){console.error(e);alert('Erro ao ler do Google: '+e)}
}

async function salvarNoGoogle(){
  try{
    const resp = await fetch(SCRIPT_URL,{
      method:'POST',               // <<< sem cabeçalho => simple request
      body: JSON.stringify( lerTabelaCadastros() )
    });
    const js = await resp.json();
    if(js.ok) console.log('Salvo na planilha!');
    else{console.error(js);alert('Erro do script: '+JSON.stringify(js))}
  }catch(e){console.error(e);alert('Falha ao salvar no Google: '+e)}
}
</script>
</body>
</html>
